---
- hosts: all
  sudo: true
  #accelerate: true

  roles:
    - common
    - nginx
    - nginx-api
    - htpasswd-api
    - jeto
    - vagrant-worker
    - nodesource.node
    - phantomjs

  tasks:
      - name: Install selenium
        shell:
          executable=/bin/bash
          pip install -U selenium

      - name: Update node to lastest version
        shell:
          executable=/bin/bash
          npm install -g npm@latest

      - name: Install node dependencies
        shell:
          executable=/bin/bash
          chdir=/vagrant/projects/jeto/jeto/aurelia
          npm install

      - name: Install Gulp
        shell:
          executable=/bin/bash
          npm install -g gulp

      - name: Install jspm globally
        shell:
          executable=/bin/bash
          npm install jspm -g

      - name: Lock jspm
        shell:
          executable=/bin/bash
          chdir=/vagrant/projects/jeto/jeto/aurelia
          npm install jspm --save-dev

      - name: Init jspm
        shell:
          executable=/bin/bash
          chdir=/vagrant/projects/jeto/jeto/aurelia
          jspm init -y

      - name: Update jspm
        shell:
          executable=/bin/bash
          chdir=/vagrant/projects/jeto/jeto/aurelia
          jspm dl-loader --latest

      - name: Install dependencies
        shell:
          executable=/bin/bash
          chdir=/vagrant/projects/jeto/jeto/aurelia
          jspm install

      - name: Build Jeto
        shell:
          executable=/bin/bash
          chdir=/vagrant/projects/jeto/jeto/aurelia
          gulp export